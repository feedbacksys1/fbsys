{% extends "admin_base.html" %}

{% block title %}Просмотр статистики{% endblock %}

{% block content %}
<div class="admin-content admin-content_full">
    <h1 class="admin-page-title">Просмотр статистики</h1>
    <p class="admin-page-lead">Статистика заявок по каждому куратору: сколько поступило, рассмотрено и ожидает рассмотрения.</p>
    <form method="get" action="{% url 'admin_statistics' %}" class="admin-search-form admin-search-form_full">
        <input type="search" name="q" value="{{ search_q }}" class="form-input admin-search-input" placeholder="Поиск по имени, фамилии, логину или email" aria-label="Поиск по куратору">
        <button type="submit" class="btn btn-primary">Найти</button>
        <a href="{% url 'admin_statistics_export' %}{% if search_q %}?q={{ search_q|urlencode }}{% endif %}" class="btn btn-primary">Скачать Excel</a>
    </form>
    <div class="admin-table-wrap">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Куратор</th>
                    <th>Всего заявок</th>
                    <th>Рассмотрено</th>
                    <th>Ожидают рассмотрения</th>
                </tr>
            </thead>
            <tbody>
                {% for item in stats %}
                <tr>
                    <td>{{ item.teacher.get_full_name|default:item.teacher.get_username }}</td>
                    <td>{{ item.total }}</td>
                    <td>{{ item.reviewed }}</td>
                    <td>{{ item.awaiting }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">Нет кураторов в системе.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
